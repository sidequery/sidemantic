{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Sidemantic Semantic Layer",
  "description": "Schema for Sidemantic semantic layer YAML configuration",
  "type": "object",
  "properties": {
    "models": {
      "type": "array",
      "description": "Model definitions",
      "items": {
        "$defs": {
          "Dimension": {
            "description": "Dimension (attribute) definition.\n\nDimensions are used for grouping and filtering in queries.",
            "properties": {
              "name": {
                "description": "Unique dimension name within model",
                "title": "Name",
                "type": "string"
              },
              "type": {
                "description": "Dimension type",
                "enum": [
                  "categorical",
                  "time",
                  "boolean",
                  "numeric"
                ],
                "title": "Type",
                "type": "string"
              },
              "sql": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "SQL expression (defaults to name; accepts 'expr' as alias)",
                "title": "Sql"
              },
              "granularity": {
                "anyOf": [
                  {
                    "enum": [
                      "hour",
                      "day",
                      "week",
                      "month",
                      "quarter",
                      "year"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Base granularity for time dimensions",
                "title": "Granularity"
              },
              "supported_granularities": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Supported granularities for time dimensions",
                "title": "Supported Granularities"
              },
              "description": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Human-readable description",
                "title": "Description"
              },
              "label": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Display label",
                "title": "Label"
              },
              "format": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Display format string (e.g., '$#,##0.00', '0.00%')",
                "title": "Format"
              },
              "value_format_name": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Named format (e.g., 'usd', 'percent', 'decimal_2')",
                "title": "Value Format Name"
              },
              "parent": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Parent dimension for hierarchies (e.g., 'state' parent is 'country')",
                "title": "Parent"
              }
            },
            "required": [
              "name",
              "type"
            ],
            "title": "Dimension",
            "type": "object"
          },
          "Index": {
            "description": "Index definition for pre-aggregation performance.",
            "properties": {
              "name": {
                "description": "Index name",
                "title": "Name",
                "type": "string"
              },
              "columns": {
                "description": "Columns to index",
                "items": {
                  "type": "string"
                },
                "title": "Columns",
                "type": "array"
              },
              "type": {
                "default": "regular",
                "description": "Index type",
                "enum": [
                  "regular",
                  "aggregate"
                ],
                "title": "Type",
                "type": "string"
              }
            },
            "required": [
              "name",
              "columns"
            ],
            "title": "Index",
            "type": "object"
          },
          "Metric": {
            "description": "Measure definition - supports simple aggregations and complex metric types.\n\nMeasures can be:\n- Simple aggregations: SUM(amount), COUNT(*), AVG(price)\n- Ratios: revenue / order_count\n- Derived formulas: (revenue - cost) / revenue\n- Cumulative: running totals, period-to-date\n- Time comparisons: YoY, MoM growth\n- Conversion funnels: signup -> purchase rate\n\nAuto-registers as a graph-level metric with the current semantic layer context if available.",
            "properties": {
              "name": {
                "description": "Unique measure name",
                "title": "Name",
                "type": "string"
              },
              "extends": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Parent metric to inherit from",
                "title": "Extends"
              },
              "agg": {
                "anyOf": [
                  {
                    "enum": [
                      "sum",
                      "count",
                      "count_distinct",
                      "avg",
                      "min",
                      "max",
                      "median"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Aggregation function (for simple measures)",
                "title": "Agg"
              },
              "sql": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "SQL expression or formula (accepts 'expr' as alias)",
                "title": "Sql"
              },
              "type": {
                "anyOf": [
                  {
                    "enum": [
                      "ratio",
                      "derived",
                      "cumulative",
                      "time_comparison",
                      "conversion"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Metric type for complex calculations",
                "title": "Type"
              },
              "numerator": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Numerator measure for ratio",
                "title": "Numerator"
              },
              "denominator": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Denominator measure for ratio",
                "title": "Denominator"
              },
              "offset_window": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Time offset for denominator (e.g., '1 month')",
                "title": "Offset Window"
              },
              "window": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Time window for cumulative (e.g., '7 days')",
                "title": "Window"
              },
              "grain_to_date": {
                "anyOf": [
                  {
                    "enum": [
                      "day",
                      "week",
                      "month",
                      "quarter",
                      "year"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Grain for period-to-date (e.g., 'month' for MTD)",
                "title": "Grain To Date"
              },
              "base_metric": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Base metric for time comparison",
                "title": "Base Metric"
              },
              "comparison_type": {
                "anyOf": [
                  {
                    "enum": [
                      "yoy",
                      "mom",
                      "wow",
                      "dod",
                      "qoq",
                      "prior_period"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Type of time comparison",
                "title": "Comparison Type"
              },
              "time_offset": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Custom time offset (e.g., '1 month')",
                "title": "Time Offset"
              },
              "calculation": {
                "anyOf": [
                  {
                    "enum": [
                      "difference",
                      "percent_change",
                      "ratio"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Comparison calculation (default: percent_change)",
                "title": "Calculation"
              },
              "entity": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Entity to track (e.g., 'user_id')",
                "title": "Entity"
              },
              "base_event": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Starting event filter",
                "title": "Base Event"
              },
              "conversion_event": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Target event filter",
                "title": "Conversion Event"
              },
              "conversion_window": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Conversion time window",
                "title": "Conversion Window"
              },
              "filters": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Optional WHERE clause filters",
                "title": "Filters"
              },
              "fill_nulls_with": {
                "anyOf": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "number"
                  },
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Default value when result is NULL",
                "title": "Fill Nulls With"
              },
              "description": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Human-readable description",
                "title": "Description"
              },
              "label": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Display label",
                "title": "Label"
              },
              "format": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Display format string (e.g., '$#,##0.00', '0.00%')",
                "title": "Format"
              },
              "value_format_name": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Named format (e.g., 'usd', 'percent', 'decimal_2')",
                "title": "Value Format Name"
              },
              "drill_fields": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Fields to show when drilling into this metric",
                "title": "Drill Fields"
              },
              "non_additive_dimension": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Dimension across which this metric cannot be summed (e.g., time for averages)",
                "title": "Non Additive Dimension"
              },
              "default_time_dimension": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Default time dimension for this metric",
                "title": "Default Time Dimension"
              },
              "default_grain": {
                "anyOf": [
                  {
                    "enum": [
                      "hour",
                      "day",
                      "week",
                      "month",
                      "quarter",
                      "year"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Default time granularity for this metric",
                "title": "Default Grain"
              }
            },
            "required": [
              "name"
            ],
            "title": "Metric",
            "type": "object"
          },
          "PreAggregation": {
            "description": "Pre-aggregation definition for automatic query optimization.\n\nPre-aggregations are materialized rollup tables that store pre-computed\naggregations. The query engine automatically routes queries to matching\npre-aggregations for significant performance improvements.\n\nExample:\n    >>> PreAggregation(\n    ...     name=\"daily_rollup\",\n    ...     measures=[\"count\", \"revenue\"],\n    ...     dimensions=[\"status\", \"region\"],\n    ...     time_dimension=\"created_at\",\n    ...     granularity=\"day\",\n    ...     partition_granularity=\"month\",\n    ...     refresh_key=RefreshKey(every=\"1 hour\", incremental=True)\n    ... )",
            "properties": {
              "name": {
                "description": "Unique pre-aggregation name",
                "title": "Name",
                "type": "string"
              },
              "type": {
                "default": "rollup",
                "description": "Pre-aggregation type",
                "enum": [
                  "rollup",
                  "original_sql",
                  "rollup_join",
                  "lambda"
                ],
                "title": "Type",
                "type": "string"
              },
              "measures": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Measures to pre-aggregate (e.g., ['count', 'revenue'])",
                "title": "Measures"
              },
              "dimensions": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Dimensions to group by (e.g., ['status', 'region'])",
                "title": "Dimensions"
              },
              "time_dimension": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Time dimension for temporal grouping",
                "title": "Time Dimension"
              },
              "granularity": {
                "anyOf": [
                  {
                    "enum": [
                      "hour",
                      "day",
                      "week",
                      "month",
                      "quarter",
                      "year"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Time granularity for aggregation",
                "title": "Granularity"
              },
              "partition_granularity": {
                "anyOf": [
                  {
                    "enum": [
                      "day",
                      "week",
                      "month",
                      "quarter",
                      "year"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Partition size for incremental refresh",
                "title": "Partition Granularity"
              },
              "refresh_key": {
                "anyOf": [
                  {
                    "$ref": "#/$defs/RefreshKey"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Refresh strategy configuration"
              },
              "scheduled_refresh": {
                "default": true,
                "description": "Whether to enable scheduled refresh",
                "title": "Scheduled Refresh",
                "type": "boolean"
              },
              "indexes": {
                "anyOf": [
                  {
                    "items": {
                      "$ref": "#/$defs/Index"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Index definitions for query performance",
                "title": "Indexes"
              },
              "build_range_start": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "SQL expression for start of data range to aggregate",
                "title": "Build Range Start"
              },
              "build_range_end": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "SQL expression for end of data range to aggregate",
                "title": "Build Range End"
              }
            },
            "required": [
              "name"
            ],
            "title": "PreAggregation",
            "type": "object"
          },
          "RefreshKey": {
            "description": "Refresh strategy configuration for pre-aggregations.",
            "properties": {
              "every": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Refresh interval (e.g., '1 hour', '1 day', '30 minutes')",
                "title": "Every"
              },
              "sql": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "SQL query that returns a value to trigger refresh when changed",
                "title": "Sql"
              },
              "incremental": {
                "default": false,
                "description": "Whether to use incremental refresh (only update changed partitions)",
                "title": "Incremental",
                "type": "boolean"
              },
              "update_window": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Time window to refresh incrementally (e.g., '7 day', '1 month')",
                "title": "Update Window"
              }
            },
            "title": "RefreshKey",
            "type": "object"
          },
          "Relationship": {
            "description": "Represents a relationship between models.\n\nRelationship types:\n- many_to_one: This model has a foreign key to another\n- one_to_one: This model is referenced by another with unique constraint\n- one_to_many: This model is referenced by another\n- many_to_many: This model relates to another through a junction table",
            "properties": {
              "name": {
                "description": "Name of the related model",
                "title": "Name",
                "type": "string"
              },
              "type": {
                "description": "Type of relationship",
                "enum": [
                  "many_to_one",
                  "one_to_one",
                  "one_to_many",
                  "many_to_many"
                ],
                "title": "Type",
                "type": "string"
              },
              "foreign_key": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Foreign key column (defaults to {name}_id for many_to_one)",
                "title": "Foreign Key"
              },
              "primary_key": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Primary key column in related model (defaults to id)",
                "title": "Primary Key"
              }
            },
            "required": [
              "name",
              "type"
            ],
            "title": "Relationship",
            "type": "object"
          },
          "Segment": {
            "description": "Segment definition - predefined reusable filter.\n\nSegments are named filters that can be applied to queries to consistently\nfilter data according to business definitions.\n\nExample:\n    active_users = Segment(\n        name=\"active_users\",\n        sql=\"{model}.status = 'active' AND {model}.last_login > CURRENT_DATE - 30\"\n    )",
            "properties": {
              "name": {
                "description": "Unique segment name",
                "title": "Name",
                "type": "string"
              },
              "sql": {
                "description": "SQL WHERE clause expression",
                "title": "Sql",
                "type": "string"
              },
              "description": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Human-readable description",
                "title": "Description"
              },
              "public": {
                "default": true,
                "description": "Whether segment is visible in API/UI",
                "title": "Public",
                "type": "boolean"
              }
            },
            "required": [
              "name",
              "sql"
            ],
            "title": "Segment",
            "type": "object"
          }
        },
        "description": "Model (dataset) definition.\n\nModels are the foundation of the semantic layer, mapping to physical tables\nor SQL expressions. Auto-registers with the current semantic layer context if available.",
        "properties": {
          "name": {
            "description": "Unique model name",
            "title": "Name",
            "type": "string"
          },
          "table": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Physical table name (schema.table)",
            "title": "Table"
          },
          "sql": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "SQL expression for derived tables",
            "title": "Sql"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Human-readable description",
            "title": "Description"
          },
          "extends": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Parent model to inherit from",
            "title": "Extends"
          },
          "relationships": {
            "description": "Relationships to other models",
            "items": {
              "$ref": "#/$defs/Relationship"
            },
            "title": "Relationships",
            "type": "array"
          },
          "primary_key": {
            "default": "id",
            "description": "Primary key column",
            "title": "Primary Key",
            "type": "string"
          },
          "dimensions": {
            "description": "Dimension definitions",
            "items": {
              "$ref": "#/$defs/Dimension"
            },
            "title": "Dimensions",
            "type": "array"
          },
          "metrics": {
            "description": "Measure definitions",
            "items": {
              "$ref": "#/$defs/Metric"
            },
            "title": "Metrics",
            "type": "array"
          },
          "segments": {
            "description": "Segment (named filter) definitions",
            "items": {
              "$ref": "#/$defs/Segment"
            },
            "title": "Segments",
            "type": "array"
          },
          "pre_aggregations": {
            "description": "Pre-aggregation definitions for query optimization",
            "items": {
              "$ref": "#/$defs/PreAggregation"
            },
            "title": "Pre Aggregations",
            "type": "array"
          }
        },
        "required": [
          "name"
        ],
        "title": "Model",
        "type": "object"
      }
    },
    "metrics": {
      "type": "array",
      "description": "Top-level metric definitions (optional - can also define in models)",
      "items": {
        "description": "Measure definition - supports simple aggregations and complex metric types.\n\nMeasures can be:\n- Simple aggregations: SUM(amount), COUNT(*), AVG(price)\n- Ratios: revenue / order_count\n- Derived formulas: (revenue - cost) / revenue\n- Cumulative: running totals, period-to-date\n- Time comparisons: YoY, MoM growth\n- Conversion funnels: signup -> purchase rate\n\nAuto-registers as a graph-level metric with the current semantic layer context if available.",
        "properties": {
          "name": {
            "description": "Unique measure name",
            "title": "Name",
            "type": "string"
          },
          "extends": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Parent metric to inherit from",
            "title": "Extends"
          },
          "agg": {
            "anyOf": [
              {
                "enum": [
                  "sum",
                  "count",
                  "count_distinct",
                  "avg",
                  "min",
                  "max",
                  "median"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Aggregation function (for simple measures)",
            "title": "Agg"
          },
          "sql": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "SQL expression or formula (accepts 'expr' as alias)",
            "title": "Sql"
          },
          "type": {
            "anyOf": [
              {
                "enum": [
                  "ratio",
                  "derived",
                  "cumulative",
                  "time_comparison",
                  "conversion"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Metric type for complex calculations",
            "title": "Type"
          },
          "numerator": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Numerator measure for ratio",
            "title": "Numerator"
          },
          "denominator": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Denominator measure for ratio",
            "title": "Denominator"
          },
          "offset_window": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Time offset for denominator (e.g., '1 month')",
            "title": "Offset Window"
          },
          "window": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Time window for cumulative (e.g., '7 days')",
            "title": "Window"
          },
          "grain_to_date": {
            "anyOf": [
              {
                "enum": [
                  "day",
                  "week",
                  "month",
                  "quarter",
                  "year"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Grain for period-to-date (e.g., 'month' for MTD)",
            "title": "Grain To Date"
          },
          "base_metric": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Base metric for time comparison",
            "title": "Base Metric"
          },
          "comparison_type": {
            "anyOf": [
              {
                "enum": [
                  "yoy",
                  "mom",
                  "wow",
                  "dod",
                  "qoq",
                  "prior_period"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Type of time comparison",
            "title": "Comparison Type"
          },
          "time_offset": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Custom time offset (e.g., '1 month')",
            "title": "Time Offset"
          },
          "calculation": {
            "anyOf": [
              {
                "enum": [
                  "difference",
                  "percent_change",
                  "ratio"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Comparison calculation (default: percent_change)",
            "title": "Calculation"
          },
          "entity": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Entity to track (e.g., 'user_id')",
            "title": "Entity"
          },
          "base_event": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Starting event filter",
            "title": "Base Event"
          },
          "conversion_event": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Target event filter",
            "title": "Conversion Event"
          },
          "conversion_window": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Conversion time window",
            "title": "Conversion Window"
          },
          "filters": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Optional WHERE clause filters",
            "title": "Filters"
          },
          "fill_nulls_with": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "number"
              },
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Default value when result is NULL",
            "title": "Fill Nulls With"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Human-readable description",
            "title": "Description"
          },
          "label": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Display label",
            "title": "Label"
          },
          "format": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Display format string (e.g., '$#,##0.00', '0.00%')",
            "title": "Format"
          },
          "value_format_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Named format (e.g., 'usd', 'percent', 'decimal_2')",
            "title": "Value Format Name"
          },
          "drill_fields": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Fields to show when drilling into this metric",
            "title": "Drill Fields"
          },
          "non_additive_dimension": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Dimension across which this metric cannot be summed (e.g., time for averages)",
            "title": "Non Additive Dimension"
          },
          "default_time_dimension": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Default time dimension for this metric",
            "title": "Default Time Dimension"
          },
          "default_grain": {
            "anyOf": [
              {
                "enum": [
                  "hour",
                  "day",
                  "week",
                  "month",
                  "quarter",
                  "year"
                ],
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Default time granularity for this metric",
            "title": "Default Grain"
          }
        },
        "required": [
          "name"
        ],
        "title": "Metric",
        "type": "object"
      }
    },
    "parameters": {
      "type": "array",
      "description": "Parameter definitions for dynamic queries",
      "items": {
        "description": "Parameter definition for user input.\n\nDEPRECATED: Use Jinja templates instead of Parameters.\n\nParameters can be referenced in filters, SQL expressions, and metric definitions\nto create dynamic, user-configurable queries.",
        "properties": {
          "name": {
            "description": "Unique parameter name",
            "title": "Name",
            "type": "string"
          },
          "type": {
            "description": "Parameter data type",
            "enum": [
              "string",
              "number",
              "date",
              "unquoted",
              "yesno"
            ],
            "title": "Type",
            "type": "string"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Human-readable description",
            "title": "Description"
          },
          "label": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Display label for UI",
            "title": "Label"
          },
          "default_value": {
            "default": null,
            "description": "Default value if not provided",
            "title": "Default Value"
          },
          "allowed_values": {
            "anyOf": [
              {
                "items": {},
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "List of allowed values (for dropdown/select)",
            "title": "Allowed Values"
          },
          "default_to_today": {
            "default": false,
            "description": "Default to current date (for date parameters)",
            "title": "Default To Today",
            "type": "boolean"
          }
        },
        "required": [
          "name",
          "type"
        ],
        "title": "Parameter",
        "type": "object"
      }
    }
  },
  "required": [
    "models"
  ],
  "$defs": {
    "Dimension": {
      "description": "Dimension (attribute) definition.\n\nDimensions are used for grouping and filtering in queries.",
      "properties": {
        "name": {
          "description": "Unique dimension name within model",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "description": "Dimension type",
          "enum": [
            "categorical",
            "time",
            "boolean",
            "numeric"
          ],
          "title": "Type",
          "type": "string"
        },
        "sql": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "SQL expression (defaults to name; accepts 'expr' as alias)",
          "title": "Sql"
        },
        "granularity": {
          "anyOf": [
            {
              "enum": [
                "hour",
                "day",
                "week",
                "month",
                "quarter",
                "year"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Base granularity for time dimensions",
          "title": "Granularity"
        },
        "supported_granularities": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Supported granularities for time dimensions",
          "title": "Supported Granularities"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description",
          "title": "Description"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display label",
          "title": "Label"
        },
        "format": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display format string (e.g., '$#,##0.00', '0.00%')",
          "title": "Format"
        },
        "value_format_name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Named format (e.g., 'usd', 'percent', 'decimal_2')",
          "title": "Value Format Name"
        },
        "parent": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Parent dimension for hierarchies (e.g., 'state' parent is 'country')",
          "title": "Parent"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "Dimension",
      "type": "object"
    },
    "Index": {
      "description": "Index definition for pre-aggregation performance.",
      "properties": {
        "name": {
          "description": "Index name",
          "title": "Name",
          "type": "string"
        },
        "columns": {
          "description": "Columns to index",
          "items": {
            "type": "string"
          },
          "title": "Columns",
          "type": "array"
        },
        "type": {
          "default": "regular",
          "description": "Index type",
          "enum": [
            "regular",
            "aggregate"
          ],
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "name",
        "columns"
      ],
      "title": "Index",
      "type": "object"
    },
    "Metric": {
      "description": "Measure definition - supports simple aggregations and complex metric types.\n\nMeasures can be:\n- Simple aggregations: SUM(amount), COUNT(*), AVG(price)\n- Ratios: revenue / order_count\n- Derived formulas: (revenue - cost) / revenue\n- Cumulative: running totals, period-to-date\n- Time comparisons: YoY, MoM growth\n- Conversion funnels: signup -> purchase rate\n\nAuto-registers as a graph-level metric with the current semantic layer context if available.",
      "properties": {
        "name": {
          "description": "Unique measure name",
          "title": "Name",
          "type": "string"
        },
        "extends": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Parent metric to inherit from",
          "title": "Extends"
        },
        "agg": {
          "anyOf": [
            {
              "enum": [
                "sum",
                "count",
                "count_distinct",
                "avg",
                "min",
                "max",
                "median"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Aggregation function (for simple measures)",
          "title": "Agg"
        },
        "sql": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "SQL expression or formula (accepts 'expr' as alias)",
          "title": "Sql"
        },
        "type": {
          "anyOf": [
            {
              "enum": [
                "ratio",
                "derived",
                "cumulative",
                "time_comparison",
                "conversion"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Metric type for complex calculations",
          "title": "Type"
        },
        "numerator": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Numerator measure for ratio",
          "title": "Numerator"
        },
        "denominator": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Denominator measure for ratio",
          "title": "Denominator"
        },
        "offset_window": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time offset for denominator (e.g., '1 month')",
          "title": "Offset Window"
        },
        "window": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time window for cumulative (e.g., '7 days')",
          "title": "Window"
        },
        "grain_to_date": {
          "anyOf": [
            {
              "enum": [
                "day",
                "week",
                "month",
                "quarter",
                "year"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grain for period-to-date (e.g., 'month' for MTD)",
          "title": "Grain To Date"
        },
        "base_metric": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Base metric for time comparison",
          "title": "Base Metric"
        },
        "comparison_type": {
          "anyOf": [
            {
              "enum": [
                "yoy",
                "mom",
                "wow",
                "dod",
                "qoq",
                "prior_period"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type of time comparison",
          "title": "Comparison Type"
        },
        "time_offset": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Custom time offset (e.g., '1 month')",
          "title": "Time Offset"
        },
        "calculation": {
          "anyOf": [
            {
              "enum": [
                "difference",
                "percent_change",
                "ratio"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Comparison calculation (default: percent_change)",
          "title": "Calculation"
        },
        "entity": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity to track (e.g., 'user_id')",
          "title": "Entity"
        },
        "base_event": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Starting event filter",
          "title": "Base Event"
        },
        "conversion_event": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target event filter",
          "title": "Conversion Event"
        },
        "conversion_window": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conversion time window",
          "title": "Conversion Window"
        },
        "filters": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional WHERE clause filters",
          "title": "Filters"
        },
        "fill_nulls_with": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "number"
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Default value when result is NULL",
          "title": "Fill Nulls With"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description",
          "title": "Description"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display label",
          "title": "Label"
        },
        "format": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display format string (e.g., '$#,##0.00', '0.00%')",
          "title": "Format"
        },
        "value_format_name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Named format (e.g., 'usd', 'percent', 'decimal_2')",
          "title": "Value Format Name"
        },
        "drill_fields": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Fields to show when drilling into this metric",
          "title": "Drill Fields"
        },
        "non_additive_dimension": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dimension across which this metric cannot be summed (e.g., time for averages)",
          "title": "Non Additive Dimension"
        },
        "default_time_dimension": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Default time dimension for this metric",
          "title": "Default Time Dimension"
        },
        "default_grain": {
          "anyOf": [
            {
              "enum": [
                "hour",
                "day",
                "week",
                "month",
                "quarter",
                "year"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Default time granularity for this metric",
          "title": "Default Grain"
        }
      },
      "required": [
        "name"
      ],
      "title": "Metric",
      "type": "object"
    },
    "PreAggregation": {
      "description": "Pre-aggregation definition for automatic query optimization.\n\nPre-aggregations are materialized rollup tables that store pre-computed\naggregations. The query engine automatically routes queries to matching\npre-aggregations for significant performance improvements.\n\nExample:\n    >>> PreAggregation(\n    ...     name=\"daily_rollup\",\n    ...     measures=[\"count\", \"revenue\"],\n    ...     dimensions=[\"status\", \"region\"],\n    ...     time_dimension=\"created_at\",\n    ...     granularity=\"day\",\n    ...     partition_granularity=\"month\",\n    ...     refresh_key=RefreshKey(every=\"1 hour\", incremental=True)\n    ... )",
      "properties": {
        "name": {
          "description": "Unique pre-aggregation name",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "default": "rollup",
          "description": "Pre-aggregation type",
          "enum": [
            "rollup",
            "original_sql",
            "rollup_join",
            "lambda"
          ],
          "title": "Type",
          "type": "string"
        },
        "measures": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Measures to pre-aggregate (e.g., ['count', 'revenue'])",
          "title": "Measures"
        },
        "dimensions": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dimensions to group by (e.g., ['status', 'region'])",
          "title": "Dimensions"
        },
        "time_dimension": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time dimension for temporal grouping",
          "title": "Time Dimension"
        },
        "granularity": {
          "anyOf": [
            {
              "enum": [
                "hour",
                "day",
                "week",
                "month",
                "quarter",
                "year"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time granularity for aggregation",
          "title": "Granularity"
        },
        "partition_granularity": {
          "anyOf": [
            {
              "enum": [
                "day",
                "week",
                "month",
                "quarter",
                "year"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Partition size for incremental refresh",
          "title": "Partition Granularity"
        },
        "refresh_key": {
          "anyOf": [
            {
              "$ref": "#/$defs/RefreshKey"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Refresh strategy configuration"
        },
        "scheduled_refresh": {
          "default": true,
          "description": "Whether to enable scheduled refresh",
          "title": "Scheduled Refresh",
          "type": "boolean"
        },
        "indexes": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Index"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Index definitions for query performance",
          "title": "Indexes"
        },
        "build_range_start": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "SQL expression for start of data range to aggregate",
          "title": "Build Range Start"
        },
        "build_range_end": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "SQL expression for end of data range to aggregate",
          "title": "Build Range End"
        }
      },
      "required": [
        "name"
      ],
      "title": "PreAggregation",
      "type": "object"
    },
    "RefreshKey": {
      "description": "Refresh strategy configuration for pre-aggregations.",
      "properties": {
        "every": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Refresh interval (e.g., '1 hour', '1 day', '30 minutes')",
          "title": "Every"
        },
        "sql": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "SQL query that returns a value to trigger refresh when changed",
          "title": "Sql"
        },
        "incremental": {
          "default": false,
          "description": "Whether to use incremental refresh (only update changed partitions)",
          "title": "Incremental",
          "type": "boolean"
        },
        "update_window": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Time window to refresh incrementally (e.g., '7 day', '1 month')",
          "title": "Update Window"
        }
      },
      "title": "RefreshKey",
      "type": "object"
    },
    "Relationship": {
      "description": "Represents a relationship between models.\n\nRelationship types:\n- many_to_one: This model has a foreign key to another\n- one_to_one: This model is referenced by another with unique constraint\n- one_to_many: This model is referenced by another\n- many_to_many: This model relates to another through a junction table",
      "properties": {
        "name": {
          "description": "Name of the related model",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "description": "Type of relationship",
          "enum": [
            "many_to_one",
            "one_to_one",
            "one_to_many",
            "many_to_many"
          ],
          "title": "Type",
          "type": "string"
        },
        "foreign_key": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Foreign key column (defaults to {name}_id for many_to_one)",
          "title": "Foreign Key"
        },
        "primary_key": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Primary key column in related model (defaults to id)",
          "title": "Primary Key"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "Relationship",
      "type": "object"
    },
    "Segment": {
      "description": "Segment definition - predefined reusable filter.\n\nSegments are named filters that can be applied to queries to consistently\nfilter data according to business definitions.\n\nExample:\n    active_users = Segment(\n        name=\"active_users\",\n        sql=\"{model}.status = 'active' AND {model}.last_login > CURRENT_DATE - 30\"\n    )",
      "properties": {
        "name": {
          "description": "Unique segment name",
          "title": "Name",
          "type": "string"
        },
        "sql": {
          "description": "SQL WHERE clause expression",
          "title": "Sql",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description",
          "title": "Description"
        },
        "public": {
          "default": true,
          "description": "Whether segment is visible in API/UI",
          "title": "Public",
          "type": "boolean"
        }
      },
      "required": [
        "name",
        "sql"
      ],
      "title": "Segment",
      "type": "object"
    },
    "Parameter": {
      "description": "Parameter definition for user input.\n\nDEPRECATED: Use Jinja templates instead of Parameters.\n\nParameters can be referenced in filters, SQL expressions, and metric definitions\nto create dynamic, user-configurable queries.",
      "properties": {
        "name": {
          "description": "Unique parameter name",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "description": "Parameter data type",
          "enum": [
            "string",
            "number",
            "date",
            "unquoted",
            "yesno"
          ],
          "title": "Type",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description",
          "title": "Description"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display label for UI",
          "title": "Label"
        },
        "default_value": {
          "default": null,
          "description": "Default value if not provided",
          "title": "Default Value"
        },
        "allowed_values": {
          "anyOf": [
            {
              "items": {},
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of allowed values (for dropdown/select)",
          "title": "Allowed Values"
        },
        "default_to_today": {
          "default": false,
          "description": "Default to current date (for date parameters)",
          "title": "Default To Today",
          "type": "boolean"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "title": "Parameter",
      "type": "object"
    }
  }
}