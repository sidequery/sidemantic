cubes:
  - name: orders
    sql_table: public.orders
    description: Customer orders with revenue and status tracking

    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true

      - name: status
        sql: status
        type: string
        description: Order status (pending, completed, cancelled)

      - name: created_at
        sql: created_at
        type: time

      - name: customer_id
        sql: customer_id
        type: number

    measures:
      - name: count
        type: count
        description: Total number of orders

      - name: revenue
        sql: amount
        type: sum
        description: Total revenue from orders
        format: usd

      - name: completed_revenue
        sql: amount
        type: sum
        filters:
          - sql: "${CUBE}.status = 'completed'"
        description: Revenue from completed orders only

      - name: avg_order_value
        sql: amount
        type: avg
        description: Average order value

      - name: conversion_rate
        type: number
        sql: "${completed_revenue} / NULLIF(${revenue}, 0)"
        description: Percentage of revenue that is completed

    segments:
      - name: high_value
        sql: "${CUBE}.amount >= 500"
        description: Orders with amount >= $500

      - name: completed
        sql: "${CUBE}.status = 'completed'"
        description: Completed orders

    joins:
      - name: customers
        sql: "${CUBE}.customer_id = ${customers.id}"
        relationship: many_to_one
