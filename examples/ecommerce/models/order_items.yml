models:
  - name: order_items
    table: order_items
    description: Individual line items within orders
    primary_key: order_item_id

    dimensions:
      - name: discount_applied
        type: categorical
        sql: discount_amount > 0
        description: Whether a discount was applied

    metrics:
      - name: item_count
        agg: count
        description: Total number of order items

      - name: quantity_sold
        agg: sum
        sql: quantity
        description: Total quantity of items sold

      - name: gross_revenue
        agg: sum
        sql: price * quantity
        description: Gross revenue before discounts

      - name: discount_amount_total
        agg: sum
        sql: discount_amount
        description: Total discount amount

      - name: net_revenue
        agg: sum
        sql: (price * quantity) - discount_amount
        description: Net revenue after discounts

      - name: avg_quantity_per_item
        agg: avg
        sql: quantity
        description: Average quantity per line item

      - name: discounted_items
        agg: count
        filters:
          - discount_amount > 0
        description: Number of items with discounts

    relationships:
      - name: orders
        type: many_to_one
        foreign_key: order_id

      - name: products
        type: many_to_one
        foreign_key: product_id
