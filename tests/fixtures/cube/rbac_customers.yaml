# Source: https://github.com/cube-js/cube/blob/master/packages/cubejs-testing/birdbox-fixtures/rbac/model/cubes/customers.yaml
# License: Apache 2.0 / MIT (cube-js/cube)
#
# Features tested: access_policy with group, member_level, row_level filters

cubes:
  - name: customers
    sql_table: users

    measures:
      - name: count
        type: count

      - name: total_count
        sql: "1"
        type: sum

    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true

      - name: city
        sql: city
        type: string

    access_policy:
      # Policy 1: All groups, but grants access to NO members
      - group: "*"
        member_level:
          includes: []

      # Policy 2: Developers get all members, but with row-level filter on city
      - group: developer
        member_level:
          includes: "*"
        row_level:
          filters:
            - member: city
              operator: equals
              values: security_context.auth.userAttributes.allowedCities

      # Policy 3: Admins get all members with no row restrictions
      - group: leadership
        member_level:
          includes: "*"
        row_level:
          allow_all: true
