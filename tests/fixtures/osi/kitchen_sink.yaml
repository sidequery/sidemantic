semantic_model:
  - name: tpcds_analytics
    description: TPC-DS benchmark semantic model
    ai_context:
      instructions: Use this model for retail sales analysis
      synonyms:
        - retail analytics
        - store sales

    datasets:
      - name: store_sales
        source: tpcds.public.store_sales
        primary_key: [ss_item_sk, ss_ticket_number]
        unique_keys:
          - [ss_item_sk, ss_ticket_number]
        description: Fact table containing all store sales transactions
        ai_context:
          synonyms:
            - sales transactions
            - store purchases
        fields:
          - name: ss_item_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_item_sk
            description: Item surrogate key
          - name: ss_ticket_number
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_ticket_number
            description: Ticket number
          - name: ss_customer_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_customer_sk
            description: Customer surrogate key
          - name: ss_store_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_store_sk
            description: Store surrogate key
          - name: ss_sold_date_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_sold_date_sk
            description: Sold date surrogate key
          - name: ss_ext_sales_price
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_ext_sales_price
            description: Extended sales price
          - name: ss_quantity
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: ss_quantity
            description: Quantity sold

      - name: customer
        source: tpcds.public.customer
        primary_key: [c_customer_sk]
        description: Customer dimension
        fields:
          - name: c_customer_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: c_customer_sk
            description: Customer surrogate key
          - name: c_first_name
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: c_first_name
            description: First name
          - name: c_last_name
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: c_last_name
            description: Last name
          - name: c_full_name
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: c_first_name || ' ' || c_last_name
                - dialect: SNOWFLAKE
                  expression: CONCAT(c_first_name, ' ', c_last_name)
            description: Customer full name (computed)
            label: Full Name
          - name: c_email_address
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: c_email_address
            description: Email address

      - name: date_dim
        source: tpcds.public.date_dim
        primary_key: [d_date_sk]
        description: Date dimension
        fields:
          - name: d_date_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: d_date_sk
            description: Date surrogate key
          - name: d_date
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: d_date
            dimension:
              is_time: true
            description: Actual date value
          - name: d_year
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: d_year
            description: Year
          - name: d_quarter_name
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: d_quarter_name
            description: Quarter name
          - name: d_month_seq
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: d_month_seq
            description: Month sequence

      - name: store
        source: tpcds.public.store
        primary_key: [s_store_sk]
        description: Store dimension
        fields:
          - name: s_store_sk
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: s_store_sk
            description: Store surrogate key
          - name: s_store_name
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: s_store_name
            description: Store name
          - name: s_city
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: s_city
            description: City
          - name: s_state
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: s_state
            description: State
          - name: s_number_employees
            expression:
              dialects:
                - dialect: ANSI_SQL
                  expression: s_number_employees
            description: Number of employees

    relationships:
      - name: store_sales_to_customer
        from: store_sales
        to: customer
        from_columns: [ss_customer_sk]
        to_columns: [c_customer_sk]

      - name: store_sales_to_date_dim
        from: store_sales
        to: date_dim
        from_columns: [ss_sold_date_sk]
        to_columns: [d_date_sk]

      - name: store_sales_to_store
        from: store_sales
        to: store
        from_columns: [ss_store_sk]
        to_columns: [s_store_sk]

    metrics:
      - name: total_sales
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: SUM(store_sales.ss_ext_sales_price)
        description: Total extended sales price
        ai_context:
          synonyms:
            - total revenue
            - sales amount

      - name: total_quantity
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: SUM(store_sales.ss_quantity)
        description: Total quantity sold

      - name: transaction_count
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: COUNT(DISTINCT store_sales.ss_ticket_number)
        description: Number of unique transactions

      - name: customer_count
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: COUNT(DISTINCT store_sales.ss_customer_sk)
        description: Number of unique customers

      - name: avg_basket_size
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: SUM(store_sales.ss_ext_sales_price) / NULLIF(COUNT(DISTINCT store_sales.ss_ticket_number), 0)
        description: Average transaction value

      - name: store_productivity
        expression:
          dialects:
            - dialect: ANSI_SQL
              expression: SUM(store_sales.ss_ext_sales_price) / NULLIF(SUM(store.s_number_employees), 0)
        description: Sales per employee across stores

    custom_extensions:
      - vendor_name: SNOWFLAKE
        data: '{"warehouse": "ANALYTICS_WH", "database": "TPCDS"}'
