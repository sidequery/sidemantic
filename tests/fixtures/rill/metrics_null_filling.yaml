# Source: rilldata/rill (Apache 2.0)
# https://github.com/rilldata/rill/blob/main/runtime/resolvers/testdata/metrics_null_filling.yaml
# Features: treat_nulls_as on measures, rolling window with null handling,
#   recursive/derived measures with requires, mix of nullable and coalesced measures
# Extracted duckdb_metrics from the test harness file.

type: metrics_view
model: duckdb_data
timeseries: time
dimensions:
  - column: country
measures:
  - name: count
    expression: count(*)
  - name: sum
    expression: sum(val)
    treat_nulls_as: 0
  - name: sum_nullable
    expression: sum(val)
  - name: sum_nullable_2day_rolling_avg_nullable
    expression: AVG(sum_nullable)
    requires: [sum_nullable]
    window:
      order: time
      frame: RANGE BETWEEN INTERVAL 2 DAY PRECEDING AND CURRENT ROW
  - name: sum_nullable_2day_rolling_avg
    expression: AVG(sum_nullable)
    requires: [sum_nullable]
    treat_nulls_as: -1
    window:
      order: time
      frame: RANGE BETWEEN INTERVAL 2 DAY PRECEDING AND CURRENT ROW
  - name: sum_2day_rolling_avg_nullable
    expression: AVG(sum)
    requires: [sum]
    window:
      order: time
      frame: RANGE BETWEEN INTERVAL 2 DAY PRECEDING AND CURRENT ROW
  - name: recursive_measure
    expression: sum_nullable_2day_rolling_avg + sum
    requires: [sum_nullable_2day_rolling_avg, sum]
  - name: recursive_measure_1
    expression: sum_nullable_2day_rolling_avg_nullable + sum_nullable
    requires: [sum_nullable_2day_rolling_avg_nullable, sum_nullable]
    treat_nulls_as: -7
