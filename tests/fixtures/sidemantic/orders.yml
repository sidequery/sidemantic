models:
  - name: orders
    table: public.orders
    description: "Order transactions"
    primary_key: order_id

    relationships:
      - name: customer
        type: many_to_one
        foreign_key: customer_id

    dimensions:
      - name: status
        type: categorical
        description: "Order status"

      - name: order_date
        type: time
        granularity: day
        sql: created_at
        description: "Order creation date"

      - name: is_high_value
        type: boolean
        sql: "order_amount > 100"

    metrics:
      - name: order_count
        agg: count
        description: "Total number of orders"

      - name: revenue
        agg: sum
        sql: order_amount
        description: "Total revenue"

      - name: completed_revenue
        agg: sum
        sql: order_amount
        filters:
          - "status = 'completed'"
        description: "Revenue from completed orders"

  - name: customers
    table: public.customers
    description: "Customer dimension"
    primary_key: customer_id

    dimensions:
      - name: region
        type: categorical
      - name: tier
        type: categorical

metrics:
  - name: total_revenue
    sql: orders.revenue
    description: "Total revenue from all orders"

  - name: conversion_rate
    type: ratio
    numerator: orders.completed_revenue
    denominator: orders.revenue
    description: "Percentage of revenue from completed orders"

  - name: revenue_per_order
    type: derived
    sql: "total_revenue / order_count"
    description: "Average revenue per order (auto-detects dependencies)"
